import"core-js/modules/es.array.map.js";import"core-js/modules/es.regexp.exec.js";import"core-js/modules/es.string.split.js";import"core-js/modules/es.string.replace.js";import"core-js/modules/es.array.iterator.js";import"core-js/modules/es.map.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.string.iterator.js";import"core-js/modules/web.dom-collections.iterator.js";import"core-js/modules/es.array.for-each.js";import"core-js/modules/web.dom-collections.for-each.js";import"core-js/modules/es.array.concat.js";import"core-js/modules/es.array.join.js";import"core-js/modules/es.promise.js";import React from"react";import PropTypes from"prop-types";import*as d3 from"d3";import cloud from"d3-cloud";import{RemoveChart}from"../../components/chart";import{createSVG}from"../../components/svg";import{getElementHeight,getElementWidth}from"../../utils/dom";export default function WordCloud(props){var svgRef=React.useRef(null),handleLoad=function(){RemoveChart(svgRef),createWordCloud(svgRef,props)};return React.useEffect(function(){handleLoad()},[props]),React.createElement("svg",{ref:svgRef})}function createWordCloud(element,props){var wordData=props.wordData,margin=props.margin,base=props.base,animation=props.animation,word=props.word;if(0!==wordData.length){void 0===base.width&&(base.width=getElementWidth(element)),void 0===base.height&&(base.height=getElementHeight(element));var wordList=wordData.split(/[\s.]+/g).map(function(w){return w.replace(/^[“‘"\-—()\[\]{}]+/g,"")}).map(function(w){return w.replace(/[;:.!?()\[\]{},"'’”\-—]+$/g,"")}).map(function(w){return w.replace(/['’]s$/g,"")}).map(function(w){return w.substring(0,30)}).map(function(w){return w.toLowerCase()}),contentWidth=base.width-margin.left-margin.right,contentHeight=base.height-margin.top-margin.bottom,svg=createSVG(element,base.width,base.height),wordMap=new Map;wordList.forEach(function(d){void 0===wordMap.get(d)?wordMap.set(d,1):wordMap.set(d,wordMap.get(d)+1)});var data=[];wordMap.forEach(function(v,k){data.push({text:k,size:v})}),void 0===word.size.range&&(word.size.range=[15,75]),void 0===word.size.domain&&(word.size.domain=[0,d3.max(data,function(d){return d.size})]),void 0===word.color.range&&(word.color.range=["#ace","#0f0"]),void 0===word.color.domain&&(word.color.domain=[0,100]);var interpolator=d3.interpolate(word.color.range[0],word.color.range[1]),wordScale=d3.scaleLinear().range(word.size.range).domain(word.size.domain),colorScale=d3.scaleSequential().interpolator(interpolator).domain(word.color.domain);svg.append("g").attr("transform","translate(\n      ".concat(margin.left+contentWidth/2,",\n      ").concat(margin.top+contentHeight/2,")"));var render=function(word){svg.select("g").append("g").selectAll("text").data(word).join("text").attr("font-size",function(d){return d.size}).attr("fill",function(d){return colorScale(d.size)}).attr("text-anchor","middle").attr("transform",function(d){return"translate(".concat(d.x,", ").concat(d.y,") rotate(").concat(d.rotate,")")}).text(function(d){return d.text})},wordLayout=cloud().size([base.width,base.height]).words(data).rotate(word.mapper.rotation).padding(word.padding).fontSize(function(d){return wordScale(d.size)}).on("end",render),wordRender=Promise.resolve(wordLayout.start());animation.enabled?wordRender.then(function(){svg.selectAll("text").attr("opacity",0).transition().attr("opacity",1).duration(animation.duration).ease(d3.easeExpInOut)}):wordRender}}WordCloud.propTypes={wordData:PropTypes.string.isRequired,base:PropTypes.objectOf(PropTypes.any),margin:PropTypes.objectOf(PropTypes.any),word:PropTypes.objectOf(PropTypes.any),animation:PropTypes.objectOf(PropTypes.any)},WordCloud.defaultProps={base:{width:void 0,height:void 0},margin:{top:50,bottom:50,right:50,left:50},word:{mapper:{getWord:function getWord(d){return d.text},getSize:function getSize(){return .3+Math.random()},rotation:function rotation(){return 30*(~~(6*Math.random())-3)}},size:{range:void 0,domain:void 0},color:{range:void 0,domain:void 0},padding:3},animation:{duration:3e3,enabled:!0}};
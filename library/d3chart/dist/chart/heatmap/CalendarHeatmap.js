function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{if(!_n&&null!=_i["return"]&&(_r=_i["return"](),Object(_r)!==_r))return}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}import"core-js/modules/es.array.fill.js";import"core-js/modules/es.array.concat.js";import"core-js/modules/es.array.reverse.js";import"core-js/modules/es.array.join.js";import"core-js/modules/es.array.filter.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.array.includes.js";import"core-js/modules/es.array.for-each.js";import"core-js/modules/web.dom-collections.for-each.js";import"core-js/modules/es.array.is-array.js";import"core-js/modules/es.symbol.js";import"core-js/modules/es.symbol.description.js";import"core-js/modules/es.symbol.iterator.js";import"core-js/modules/es.array.iterator.js";import"core-js/modules/es.string.iterator.js";import"core-js/modules/web.dom-collections.iterator.js";import"core-js/modules/es.array.slice.js";import"core-js/modules/es.function.name.js";import"core-js/modules/es.array.from.js";import"core-js/modules/es.regexp.exec.js";import"core-js/modules/es.regexp.test.js";import React from"react";import*as d3 from"d3";import{createSVG}from"../../components/svg";import{RemoveChart}from"../../components/chart";import{createTooltip}from"../../components/tooltip";import{getElementHeight,getElementWidth}from"../../utils/dom";import{createTitle}from"../../components/text";import PropTypes from"prop-types";import{createSequentialLegend}from"../../components/legend";export default function CalendarHeatmap(props){var svgRef=React.useRef(null),handleLoad=function(){RemoveChart(svgRef),CreateCalendarHeatmap(svgRef,props)};return React.useEffect(function(){handleLoad()},[props]),React.createElement("svg",{width:"100%",ref:svgRef})}function CreateCalendarHeatmap(element,props){function pathMonth(t){var d=Math.max(0,Math.min(weekDays,countDay(t.getUTCDay()))),w=timeWeek.count(d3.utcYear(t),t);return"".concat(0===d?"M".concat(w*cellSize,",0"):d===weekDays?"M".concat((w+1)*cellSize,",0"):"M".concat((w+1)*cellSize,",0V").concat(d*cellSize,"H").concat(w*cellSize),"V").concat(weekDays*cellSize)}var data=props.data,mapper=props.mapper,base=props.base,margin=props.margin,animation=props.animation,heatmap=props.heatmap,tooltip=props.tooltip,fill=props.fill,font=props.font,event=props.event,legend=props.legend;if(0!==data.length){void 0===base.width&&(base.width=getElementWidth(element)),void 0===base.height&&(base.height=getElementHeight(element));var x=d3.map(d3.map(data,mapper.getX),function(d){return d3.utcParse(heatmap.utcParse)(d)}),y=d3.map(data,mapper.getY),I=d3.range(x.length),cellSize=(base.width-margin.top-margin.right)/53;void 0===tooltip.mapper&&(tooltip.mapper=function(i){return"date: ".concat(d3.utcFormat(heatmap.formatUTCTip)(x[i]),"\nvalue: ").concat(y[i])}),void 0===font.size&&(font.size=Math.min(base.width,base.height)/25+"px");var colorScale,countDay="sunday"===heatmap.weekday?function(i){return i}:function(i){return(i+6)%7},timeWeek="sunday"===heatmap.weekday?d3.utcSunday:d3.utcMonday,weekDays="weekday"===heatmap.weekday?5:7,height=cellSize*(weekDays+2),years=d3.groups(I,function(i){return x[i].getFullYear()}).reverse(),max=d3.quantile(y,.9975,Math.abs),formatMonth=d3.utcFormat(heatmap.monthParse);if(void 0===fill.color)colorScale=d3.scaleSequential([-max,max],d3.interpolateBuGn).unknown("none");else{var interpolator=d3.interpolate(fill.color[0],fill.color[1]);colorScale=d3.scaleSequential([-max,max],interpolator).unknown("none")}var svg=createSVG(element,base.width,height*years.length+margin.top+margin.bottom),year=svg.selectAll("g").data(years).join("g").attr("transform",function(_,i){return"translate(".concat(margin.left,", ").concat(margin.top+height*i+1.5*cellSize,")")});year.append("text").attr("x",-5).attr("y",-5).attr("font-size",font.size).attr("font-weight","bold").attr("text-anchor","end").attr("fill","currentColor").text(function(_ref){var _ref2=_slicedToArray(_ref,1),key=_ref2[0];return key}),year.append("g").attr("text-anchor","end").attr("font-size",font.size).selectAll("text").data("weekday"===heatmap.weekday?d3.range(1,6):d3.range(7)).join("text").attr("x",-5).attr("y",function(i){return(countDay(i)+.5)*cellSize}).attr("dy","0.31em").attr("fill","currentColor").text(heatmap.formatDay);var cell=year.append("g");cell.selectAll("rect").data("weekday"===heatmap.weekday?function(_ref3){var _ref4=_slicedToArray(_ref3,2),I=_ref4[1];return I.filter(function(i){return![0,6].includes(x[i].getUTCDay())})}:function(_ref5){var _ref6=_slicedToArray(_ref5,2),I=_ref6[1];return I}).join("rect").attr("class",function(i){return"cell_"+x[i].getFullYear()+" "+x[i].getFullYear()+"-"+x[i].getMonth()+"-"+x[i].getDate()}).attr("width",cellSize-1).attr("height",cellSize-1).attr("x",function(i){return timeWeek.count(d3.utcYear(x[i]),x[i])*cellSize+.5}).attr("y",function(i){return countDay(x[i].getUTCDay())*cellSize+.5}).attr("rx",3).attr("fill",function(i){return null===y[i]?fill.nullColor:colorScale(y[i])}).on("click",event.onClick);var month=year.append("g").selectAll("g").data(function(_ref7){var _ref8=_slicedToArray(_ref7,2),I=_ref8[1];return d3.utcMonths(d3.utcMonth(x[I[0]]),x[I[I.length-1]])}).join("g");if(month.filter(function(d,i){return i}).append("path").attr("fill","none").attr("stroke","currentColor").attr("stroke-width",3).attr("d",pathMonth),month.append("text").attr("x",function(d){return timeWeek.count(d3.utcYear(d),timeWeek.ceil(d))*cellSize+2}).attr("y",-5).attr("font-size",font.size).attr("fill","currentColor").text(formatMonth),createTitle(svg,props),animation.enabled)for(var i=0;11>i;i++)cell.selectAll("rect").data("weekday"===heatmap.weekday?function(_ref9){var _ref10=_slicedToArray(_ref9,2),I=_ref10[1];return I.filter(function(i){return![0,6].includes(x[i].getUTCDay())})}:function(_ref11){var _ref12=_slicedToArray(_ref11,2),I=_ref12[1];return I}).attr("fill","none").attr("width",0).transition().attr("width",cellSize-1).attr("fill",function(i){return null===y[i]?fill.nullColor:colorScale(y[i])}).duration(animation.duration).ease(d3.easeExpInOut);legend.enabled&&createSequentialLegend(svg,colorScale,props),tooltip.enabled&&years.forEach(function(y,i){var _createTooltip=createTooltip(svg,props,margin.left,margin.top+1.5*cellSize+height*i),showTooltip=_createTooltip.showTooltip,moveTooltip=_createTooltip.moveTooltip,hideTooltip=_createTooltip.hideTooltip;cell.selectAll(".cell_"+y[0]).on("mouseover",showTooltip).on("mousemove",moveTooltip).on("mouseleave",hideTooltip)})}}CalendarHeatmap.propTypes={data:PropTypes.arrayOf(PropTypes.object).isRequired,mapper:PropTypes.objectOf(PropTypes.any),base:PropTypes.objectOf(PropTypes.any),margin:PropTypes.objectOf(PropTypes.number),tooltip:PropTypes.objectOf(PropTypes.any),animation:PropTypes.objectOf(PropTypes.any),legend:PropTypes.objectOf(PropTypes.any),font:PropTypes.objectOf(PropTypes.any),fill:PropTypes.objectOf(PropTypes.any),heatmap:PropTypes.objectOf(PropTypes.any)},CalendarHeatmap.defaultProps={mapper:{getX:function getX(d){return d.date},getY:function getY(d){return d.value}},base:{title:"CalendarHeatmap",width:void 0},fill:{colors:void 0,nullColor:"#808080"},tooltip:{mapper:void 0,enabled:!0},margin:{top:65,bottom:0,left:40,right:0},legend:{title:"frequency",enabled:!0},font:{size:"12px"},animation:{enabled:!0,duration:2e3},heatmap:{utcParse:"%Y-%m-%d",monthParse:"%b",formatUTCTip:"%Y-%m-%d",formatDay:function formatDay(i){return"SMTWTFS"[i]},formatTick:void 0,weekday:"sunday"},event:{onClick:void 0}};